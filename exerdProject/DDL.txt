CREATE TABLE CMPY_TBL (
	CMPY_NM  VARCHAR(50) NOT NULL, -- 기획사이름
	CMPY_REP VARCHAR(50) NOT NULL, -- 기획사대표
	FILE_IDX INTEGER     NULL      -- 파일인덱스
);

-- 기획사
ALTER TABLE CMPY_TBL ADD CONSTRAINT PK_CMPY_TBL PRIMARY KEY ( CMPY_NM );

-- 그룹
CREATE TABLE GRP_TBL (
	GRP_IDX  INTEGER      NOT NULL, -- 그룹인덱스
	STAR_IDX INTEGER      NOT NULL, -- 연예인인덱스
	CLB_SITE VARCHAR(255) NOT NULL DEFAULT ''  -- 팬클럽사이트
);

-- 그룹
ALTER TABLE GRP_TBL ADD CONSTRAINT PK_GRP_TBL PRIMARY KEY (GRP_IDX);
ALTER TABLE GRP_TBL MODIFY GRP_IDX INTEGER NOT NULL AUTO_INCREMENT;
ALTER TABLE GRP_TBL AUTO_INCREMENT=1;

-- 연예인멤버
CREATE TABLE STAR_MEM_TBL (
	STAR_MEM_IDX   INTEGER                NOT NULL, -- 연예인멤버인덱스
	STAR_MEM_HGHT  INTEGER                NOT NULL, -- 연예인멤버키
	STAR_MEM_BLD   ENUM('A','AB','B','O') NOT NULL, -- 연예인멤버혈액형
	STAR_MEM_WGHT  INTEGER                NOT NULL, -- 연예인멤버몸무게
	STAR_MEM_BIRTH DATETIME                   NOT NULL, -- 연예인멤버출생
	STAR_IDX       INTEGER                NOT NULL, -- 연예인인덱스
	GRP_IDX        INTEGER                NOT NULL DEFAULT 0  -- 그룹인덱스
);

-- 연예인멤버
ALTER TABLE STAR_MEM_TBL ADD CONSTRAINT PK_STAR_MEM_TBL PRIMARY KEY (STAR_MEM_IDX);
ALTER TABLE STAR_MEM_TBL MODIFY STAR_MEM_IDX INTEGER NOT NULL AUTO_INCREMENT;
ALTER TABLE STAR_MEM_TBL AUTO_INCREMENT=1;
-- 회원
CREATE TABLE MEM_TBL (
	MEM_ID   VARCHAR(320)                   NOT NULL, -- 회원아이디
	MEM_PWD  VARCHAR(100)                   NOT NULL, -- 회원비밀번호
	MEM_NICK VARCHAR(50)                    NOT NULL, -- 회원닉네임
	MEM_NM   VARCHAR(50)                    NOT NULL, -- 회원이름
	MEM_STAT ENUM('미인증','회원','관리자') NOT NULL, -- 회원상태
	ACVT     BOOLEAN                        NOT NULL DEFAULT 0, -- 활성
	FILE_IDX INTEGER                        NULL      -- 파일인덱스
);

-- 회원
ALTER TABLE MEM_TBL ADD CONSTRAINT PK_MEM_TBL PRIMARY KEY (MEM_ID);

-- 게시글
CREATE TABLE POST_TBL (
	POST_IDX     INTEGER      NOT NULL, -- 게시글인덱스
	MEM_ID       VARCHAR(320) NOT NULL, -- 회원아이디
	STAR_IDX     INTEGER      NOT NULL, -- 연예인인덱스
	POST_TTL     VARCHAR(50)  NOT NULL DEFAULT '', -- 게시글제목
	POST_DATE    DATETIME     NOT NULL, -- 게시글날짜
	POST_CON     TEXT         NOT NULL, -- 게시글내용
	POST_HIT_CNT INTEGER      NOT NULL DEFAULT 0  -- 게시글조회수
);

-- 게시글
ALTER TABLE POST_TBL ADD CONSTRAINT PK_POST_TBL PRIMARY KEY (POST_IDX);
ALTER TABLE POST_TBL MODIFY POST_IDX INTEGER NOT NULL AUTO_INCREMENT;
ALTER TABLE POST_TBL AUTO_INCREMENT=1;
-- 댓글
CREATE TABLE CMNT_TBL (
	CMNT_IDX      INTEGER      NOT NULL, -- 댓글인덱스
	CMNT_CON      TEXT         NOT NULL, -- 댓글내용
	CMNT_DATE     DATETIME         NOT NULL, -- 댓글날짜
	POST_IDX      INTEGER      NOT NULL, -- 게시글인덱스
	MEM_ID        VARCHAR(320) NOT NULL, -- 회원아이디
	HIGH_CMNT_IDX INTEGER      NULL      -- 상위댓글인덱스
);

-- 댓글
ALTER TABLE CMNT_TBL ADD CONSTRAINT PK_CMNT_TBL PRIMARY KEY (CMNT_IDX);
ALTER TABLE CMNT_TBL MODIFY CMNT_IDX INTEGER NOT NULL AUTO_INCREMENT;
ALTER TABLE CMNT_TBL AUTO_INCREMENT=1;
-- 스케쥴
CREATE TABLE SCHE_TBL (
	SCHE_IDX  INTEGER      NOT NULL, -- 스케쥴인덱스
	SCHE_NM   VARCHAR(50)  NOT NULL, -- 스케쥴이름
	SCHE_DATE DATETIME         NOT NULL, -- 스케쥴날짜
	SCHE_TRM  INTEGER      NOT NULL, -- 스케쥴기간
	STAR_IDX  INTEGER      NOT NULL, -- 연예인인덱스
	MEM_ID    VARCHAR(320) NOT NULL  -- 회원아이디
);

ALTER TABLE SCHE_TBL ADD CONSTRAINT PK_SCHE_TBL PRIMARY KEY (SCHE_IDX);
ALTER TABLE SCHE_TBL MODIFY SCHE_IDX INTEGER NOT NULL AUTO_INCREMENT;
ALTER TABLE SCHE_TBL AUTO_INCREMENT=1;

-- 태그
CREATE TABLE TAG_TBL (
	TAG_NM VARCHAR(50) NOT NULL -- 태그이름
);

-- 태그
ALTER TABLE TAG_TBL ADD CONSTRAINT PK_TAG_TBL PRIMARY KEY (TAG_NM);

-- 선호연예인
CREATE TABLE LIKE_STAR_TBL (
	STAR_IDX INTEGER      NOT NULL, -- 연예인인덱스
	MEM_ID   VARCHAR(320) NOT NULL  -- 회원아이디
);

-- 연예인
CREATE TABLE STAR_TBL (
	STAR_IDX      INTEGER            NOT NULL, -- 연예인인덱스
	STAR_NM       VARCHAR(50)        NOT NULL, -- 연예인이름
	STAR_TYP      ENUM('GRP','STAR') NOT NULL, -- 연예인유형
	STAR_DBT_DATE DATETIME               NOT NULL, -- 연예인데뷔날짜
	CMPY_NM       VARCHAR(50)        NOT NULL, -- 기획사이름
	FILE_IDX      INTEGER            NULL      -- 파일인덱스
);

-- 연예인
ALTER TABLE STAR_TBL ADD CONSTRAINT PK_STAR_TBL PRIMARY KEY (STAR_IDX);
ALTER TABLE STAR_TBL MODIFY STAR_IDX INTEGER NOT NULL AUTO_INCREMENT;
ALTER TABLE STAR_TBL AUTO_INCREMENT=1;
-- 파일
CREATE TABLE FILE_TBL (
	FILE_IDX      INTEGER      NOT NULL, -- 파일인덱스
	FILE_NM       VARCHAR(50)  NOT NULL, -- 파일이름
	FILE_PATH     VARCHAR(255) NOT NULL, -- 파일경로
	FILE_CRT_DATE DATETIME         NOT NULL  -- 파일생성날짜
);

-- 파일
ALTER TABLE FILE_TBL ADD CONSTRAINT PK_FILE_TBL PRIMARY KEY (FILE_IDX);
ALTER TABLE FILE_TBL MODIFY FILE_IDX INTEGER NOT NULL AUTO_INCREMENT;
ALTER TABLE FILE_TBL AUTO_INCREMENT = 1;
-- 게시글파일
CREATE TABLE POST_FILE_TBL (
	POST_IDX INTEGER NOT NULL, -- 게시글인덱스
	FILE_IDX INTEGER NOT NULL  -- 파일인덱스
);

-- 밈
CREATE TABLE MM_TBL (
	MM_IDX     INTEGER      NOT NULL, -- 밈인덱스
	MM_HIT_CNT INTEGER      NOT NULL DEFAULT 0, -- 밈조회수
	FILE_IDX   INTEGER      NOT NULL, -- 파일인덱스
	MEM_ID     VARCHAR(320) NOT NULL  -- 회원아이디
);

-- 밈
ALTER TABLE MM_TBL ADD CONSTRAINT PK_MM_TBL PRIMARY KEY (MM_IDX);
ALTER TABLE MM_TBL MODIFY MM_IDX INTEGER NOT NULL AUTO_INCREMENT;
ALTER TABLE MM_TBL AUTO_INCREMENT=1;

-- 연예인태그
CREATE TABLE STAR_TAG_TBL (
	STAR_IDX INTEGER     NOT NULL, -- 연예인인덱스
	TAG_NM   VARCHAR(50) NOT NULL  -- 태그이름
);

-- 밈태그
CREATE TABLE MM_TAG_TBL (
	TAG_NM VARCHAR(50) NOT NULL, -- 태그이름
	MM_IDX INTEGER     NOT NULL  -- 밈인덱스
);

-- 추천
CREATE TABLE RECM_TBL (
	POST_IDX INTEGER      NOT NULL, -- 게시글인덱스
	MEM_ID   VARCHAR(320) NOT NULL  -- 회원아이디
);

-- 게시글태그
CREATE TABLE POST_TAG_TBL (
	POST_IDX INTEGER     NOT NULL, -- 게시글인덱스
	TAG_NM   VARCHAR(50) NOT NULL  -- 태그이름
);

-- 연예인밈
CREATE TABLE STAR_MM_TBL (
	STAR_IDX INTEGER NOT NULL, -- 연예인인덱스
	MM_IDX   INTEGER NOT NULL  -- 밈인덱스
);

-- 기획사
ALTER TABLE CMPY_TBL ADD CONSTRAINT FK_FILE_TBL_TO_CMPY_TBL FOREIGN KEY (FILE_IDX) REFERENCES FILE_TBL (FILE_IDX);

-- 그룹
ALTER TABLE GRP_TBL ADD CONSTRAINT FK_STAR_TBL_TO_GRP_TBL FOREIGN KEY (STAR_IDX) REFERENCES STAR_TBL (STAR_IDX) ON DELETE CASCADE;

-- 연예인멤버
ALTER TABLE STAR_MEM_TBL ADD CONSTRAINT FK_STAR_TBL_TO_STAR_MEM_TBL FOREIGN KEY (STAR_IDX) REFERENCES STAR_TBL (STAR_IDX) ON DELETE CASCADE;

-- 연예인멤버
ALTER TABLE STAR_MEM_TBL ADD CONSTRAINT FK_GRP_TBL_TO_STAR_MEM_TBL FOREIGN KEY (GRP_IDX) REFERENCES GRP_TBL (GRP_IDX);

-- 회원
ALTER TABLE MEM_TBL ADD CONSTRAINT FK_FILE_TBL_TO_MEM_TBL FOREIGN KEY (FILE_IDX) REFERENCES FILE_TBL (FILE_IDX);

-- 게시글
ALTER TABLE POST_TBL ADD CONSTRAINT FK_STAR_TBL_TO_POST_TBL FOREIGN KEY (STAR_IDX) REFERENCES STAR_TBL (STAR_IDX) ON DELETE CASCADE;

-- 게시글
ALTER TABLE POST_TBL ADD CONSTRAINT FK_MEM_TBL_TO_POST_TBL FOREIGN KEY (MEM_ID) REFERENCES MEM_TBL (MEM_ID) ON DELETE CASCADE;

-- 댓글
ALTER TABLE CMNT_TBL ADD CONSTRAINT FK_POST_TBL_TO_CMNT_TBL FOREIGN KEY (POST_IDX) REFERENCES POST_TBL (POST_IDX) ON DELETE CASCADE;

-- 댓글
ALTER TABLE CMNT_TBL ADD CONSTRAINT FK_MEM_TBL_TO_CMNT_TBL FOREIGN KEY (MEM_ID) REFERENCES MEM_TBL (MEM_ID);

-- 댓글
ALTER TABLE CMNT_TBL ADD CONSTRAINT FK_CMNT_TBL_TO_CMNT_TBL FOREIGN KEY (HIGH_CMNT_IDX) REFERENCES CMNT_TBL (CMNT_IDX) ON DELETE CASCADE;

-- 스케쥴
ALTER TABLE SCHE_TBL ADD CONSTRAINT FK_STAR_TBL_TO_SCHE_TBL FOREIGN KEY (STAR_IDX) REFERENCES STAR_TBL (STAR_IDX) ON DELETE CASCADE;

-- 스케쥴
ALTER TABLE SCHE_TBL ADD CONSTRAINT FK_MEM_TBL_TO_SCHE_TBL FOREIGN KEY (MEM_ID) REFERENCES MEM_TBL (MEM_ID);

-- 선호연예인
ALTER TABLE LIKE_STAR_TBL ADD CONSTRAINT FK_MEM_TBL_TO_LIKE_STAR_TBL FOREIGN KEY (MEM_ID) REFERENCES MEM_TBL (MEM_ID) ON DELETE CASCADE;

-- 선호연예인
ALTER TABLE LIKE_STAR_TBL ADD CONSTRAINT FK_STAR_TBL_TO_LIKE_STAR_TBL FOREIGN KEY (STAR_IDX) REFERENCES STAR_TBL (STAR_IDX) ON DELETE CASCADE;

-- 연예인
ALTER TABLE STAR_TBL ADD CONSTRAINT FK_CMPY_TBL_TO_STAR_TBL FOREIGN KEY (CMPY_NM) REFERENCES CMPY_TBL (CMPY_NM);

-- 연예인
ALTER TABLE STAR_TBL ADD CONSTRAINT FK_FILE_TBL_TO_STAR_TBL FOREIGN KEY (FILE_IDX) REFERENCES FILE_TBL (FILE_IDX);

-- 게시글파일
ALTER TABLE POST_FILE_TBL ADD CONSTRAINT FK_POST_TBL_TO_POST_FILE_TBL FOREIGN KEY (POST_IDX) REFERENCES POST_TBL (POST_IDX) ON DELETE CASCADE;

-- 게시글파일
ALTER TABLE POST_FILE_TBL ADD CONSTRAINT FK_FILE_TBL_TO_POST_FILE_TBL FOREIGN KEY (FILE_IDX) REFERENCES FILE_TBL (FILE_IDX) ON DELETE CASCADE;

-- 밈
ALTER TABLE MM_TBL ADD CONSTRAINT FK_FILE_TBL_TO_MM_TBL FOREIGN KEY (FILE_IDX) REFERENCES FILE_TBL (FILE_IDX) ON DELETE CASCADE;

-- 밈
ALTER TABLE MM_TBL ADD CONSTRAINT FK_MEM_TBL_TO_MM_TBL FOREIGN KEY (MEM_ID) REFERENCES MEM_TBL (MEM_ID) ON DELETE CASCADE;

-- 연예인태그
ALTER TABLE STAR_TAG_TBL ADD CONSTRAINT FK_STAR_TBL_TO_STAR_TAG_TBL FOREIGN KEY (STAR_IDX) REFERENCES STAR_TBL (STAR_IDX) ON DELETE CASCADE;

-- 연예인태그
ALTER TABLE STAR_TAG_TBL ADD CONSTRAINT FK_TAG_TBL_TO_STAR_TAG_TBL FOREIGN KEY (TAG_NM) REFERENCES TAG_TBL (TAG_NM);

-- 밈태그
ALTER TABLE MM_TAG_TBL ADD CONSTRAINT FK_TAG_TBL_TO_MM_TAG_TBL FOREIGN KEY (TAG_NM) REFERENCES TAG_TBL (TAG_NM);

-- 밈태그
ALTER TABLE MM_TAG_TBL ADD CONSTRAINT FK_MM_TBL_TO_MM_TAG_TBL FOREIGN KEY (MM_IDX) REFERENCES MM_TBL (MM_IDX) ON DELETE CASCADE;

-- 추천
ALTER TABLE RECM_TBL ADD CONSTRAINT FK_POST_TBL_TO_RECM_TBL FOREIGN KEY (POST_IDX) REFERENCES POST_TBL (POST_IDX) ON DELETE CASCADE;

-- 추천
ALTER TABLE RECM_TBL ADD CONSTRAINT FK_MEM_TBL_TO_RECM_TBL FOREIGN KEY (MEM_ID) REFERENCES MEM_TBL (MEM_ID) ON DELETE CASCADE;

-- 게시글태그
ALTER TABLE POST_TAG_TBL ADD CONSTRAINT FK_POST_TBL_TO_POST_TAG_TBL FOREIGN KEY (POST_IDX) REFERENCES POST_TBL (POST_IDX) ON DELETE CASCADE;

-- 게시글태그
ALTER TABLE POST_TAG_TBL ADD CONSTRAINT FK_TAG_TBL_TO_POST_TAG_TBL FOREIGN KEY (TAG_NM) REFERENCES TAG_TBL (TAG_NM);

-- 연예인밈
ALTER TABLE STAR_MM_TBL ADD CONSTRAINT FK_STAR_TBL_TO_STAR_MM_TBL FOREIGN KEY (STAR_IDX) REFERENCES STAR_TBL (STAR_IDX);

-- 연예인밈
ALTER TABLE STAR_MM_TBL ADD CONSTRAINT FK_MM_TBL_TO_STAR_MM_TBL FOREIGN KEY (MM_IDX) REFERENCES MM_TBL (MM_IDX) ON DELETE CASCADE;
